<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        td, th {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        caption {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        .navigation {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="navigation">
        <button id="prev-month">Mes Anterior</button>
        <select id="month-selector">
            <option value="1">Enero</option>
            <option value="2">Febrero</option>
            <option value="3">Marzo</option>
            <option value="4">Abril</option>
            <option value="5">Mayo</option>
            <option value="6">Junio</option>
            <option value="7">Julio</option>
            <option value="8">Agosto</option>
            <option value="9">Septiembre</option>
            <option value="10">Octubre</option>
            <option value="11">Noviembre</option>
            <option value="12">Diciembre</option>
        </select>
        <select id="year-selector">
            <option value="2023">2023</option>
            <option value="2024" selected>2024</option>
            <option value="2025">2025</option>
            <!-- Agregar más años según sea necesario -->
        </select>
        <button id="next-month">Mes Siguiente</button>
    </div>

    <table>
        <caption id="current-month"></caption>
        <thead>
            <tr>
                <th>Do</th><th>Lu</th><th>Ma</th><th>Mi</th><th>Ju</th><th>Vi</th><th>Sa</th>
            </tr>
        </thead>
        <tbody id="calendar-body">
            <!-- Los datos del calendario se cargarán aquí -->
        </tbody>
    </table>

    <script>
        // Obtener elementos del DOM
        const prevMonthButton = document.getElementById("prev-month");
        const nextMonthButton = document.getElementById("next-month");
        const monthSelector = document.getElementById("month-selector");
        const yearSelector = document.getElementById("year-selector");
        const currentMonthElement = document.getElementById("current-month");

        // Función para obtener la fecha actual
        function getCurrentDate() {
            const currentDate = new Date();
            return {
                year: currentDate.getFullYear(),
                month: currentDate.getMonth() + 1
            };
        }

        // Función para actualizar el texto del mes y año actual
        function updateCurrentMonthText(year, month) {
            const monthName = new Date(year, month - 1, 1).toLocaleString('es', { month: 'long' });
            currentMonthElement.textContent = `${monthName} ${year}`;
        }

        // Función para cargar el calendario del mes especificado
        function loadCalendar(year, month) {
            fetch(`http://localhost:8080/calendar/by_month/${year}/${month}`)
                .then(response => response.json())
                .then(data => {
                    createCalendar(data);
                    updateCurrentMonthText(year, month);
                })
                .catch(error => {
                    console.error("Error al obtener los datos del calendario:", error);
                });
        }

        // Función para procesar y estructurar los datos del calendario
        function createCalendar(data) {
            const calendarioElement = document.getElementById("calendar-body");
            calendarioElement.innerHTML = ''; // Limpiar el contenido existente

            const daysInWeek = 7; // Número de días en una semana
            const weeks = data.length / daysInWeek; // Calcular el número de semanas

            for (let i = 0; i < weeks; i++) {
                const weekRow = document.createElement('tr');

                for (let j = i * daysInWeek; j < (i + 1) * daysInWeek; j++) {
                    const day = data[j];
                    const cell = document.createElement('td');
                    cell.textContent = day !== '-' ? day : '';  // Mostrar día o dejar vacío
                    weekRow.appendChild(cell);
                }

                calendarioElement.appendChild(weekRow);
            }
        }

        // Obtener la fecha actual
        const currentDate = getCurrentDate();
        updateCurrentMonthText(currentDate.year, currentDate.month);
        loadCalendar(currentDate.year, currentDate.month);

        // Event listener para el botón de mes anterior
        prevMonthButton.addEventListener("click", () => {
            let year = parseInt(yearSelector.value);
            let month = parseInt(monthSelector.value) - 1;
            if (month === 0) {
                year--;
                month = 12;
            }
            loadCalendar(year, month);
            yearSelector.value = year;
            monthSelector.value = month;
        });

        // Event listener para el botón de mes siguiente
        nextMonthButton.addEventListener("click", () => {
            let year = parseInt(yearSelector.value);
            let month = parseInt(monthSelector.value) + 1;
            if (month === 13) {
                year++;
                month = 1;
            }
            loadCalendar(year, month);
            yearSelector.value = year;
            monthSelector.value = month;
        });

        // Event listener para el cambio en el selector de mes o año
        monthSelector.addEventListener("change", () => {
            const year = parseInt(yearSelector.value);
            const month = parseInt(monthSelector.value);
            loadCalendar(year, month);
            updateCurrentMonthText(year, month);
        });

        yearSelector.addEventListener("change", () => {
            const year = parseInt(yearSelector.value);
            const month = parseInt(monthSelector.value);
            loadCalendar(year, month);
            updateCurrentMonthText(year, month);
        });
    </script>
</body>
</html>
